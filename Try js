
const btnAddOpen = document.getElementById("btnAddOpen");
const modalForm = document.getElementById("modalForm");
const saveWorker = document.getElementById("saveWorker");

const fullName = document.getElementById("fullName");
const email = document.getElementById("email");
const phone = document.getElementById("phone");
const photo = document.getElementById("photo");
const role = document.getElementById("role");


const expCompany = document.getElementById("expCompany");
const expRole = document.getElementById("expRole");
const expStart = document.getElementById("expStart");
const expEnd = document.getElementById("expEnd");
const addExp = document.getElementById("addExp");
const experienceList = document.getElementById("experienceList");


const popupSelect = document.getElementById("popupSelect");
const popupList = document.getElementById("popupList");
const closePopup = document.getElementById("closePopup");


const profilePopup = document.getElementById("profilePopup");
const profileName = document.getElementById("profileName");
const profilePhoto = document.getElementById("profilePhoto");
const profileRole = document.getElementById("profileRole");
const profileEmail = document.getElementById("profileEmail");
const profilePhone = document.getElementById("profilePhone");
const profileExperiences = document.getElementById("profileExperiences");
const closeProfile = document.getElementById("closeProfile");


const unassignedList = document.getElementById("unassignedList");


const rooms = {
  roomOne: document.getElementById("roomOne"),
  roomTwo: document.getElementById("roomTwo"),
  roomTree: document.getElementById("roomTree"),
  roomFor: document.getElementById("roomFor"),
  roomFive: document.getElementById("roomFive"),
  roomsx: document.getElementById("roomsx")
};


let workers = JSON.parse(localStorage.getItem("workers")) || [];
let experiences = [];


btnAddOpen.addEventListener("click", () => {
  modalForm.classList.remove("hidden");
});

saveWorker.addEventListener("click", () => {
  if (!fullName.value) return alert("Enter name!");

  const worker = {
    id: Date.now(),
    name: fullName.value,
    email: email.value,
    phone: phone.value,
    photo: photo.value,
    role: role.value,
    experiences: [...experiences],
    room: null
  };
  workers.push(worker);
  experiences = [];
  saveData();
  renderWorkers();
  clearForm();
  modalForm.classList.add("hidden");
});


addExp.addEventListener("click", () => {
  if (!expCompany.value || !expRole.value) return alert("Complete experience!");
  const exp = {
    company: expCompany.value,
    role: expRole.value,
    start: expStart.value,
    end: expEnd.value
  };
  experiences.push(exp);
  renderExperienceList();
  expCompany.value = ""; expRole.value = ""; expStart.value = ""; expEnd.value = "";
});

function renderExperienceList() {
  experienceList.innerHTML = "";
  experiences.forEach((e, i) => {
    const div = document.createElement("div");
    div.textContent = `${e.role} at ${e.company} (${e.start} - ${e.end})`;
    experienceList.appendChild(div);
  });
}


function saveData() {
  localStorage.setItem("workers", JSON.stringify(workers));
}


function renderWorkers() {
  unassignedList.innerHTML = "";
  workers.forEach(worker => {
    if (!worker.room) {
      const div = document.createElement("div");
      div.classList.add("flex", "items-center", "gap-2", "bg-white", "p-2", "rounded", "cursor-pointer", "hover:bg-blue-100");
      div.innerHTML = `<img src="${worker.photo}" class="w-10 h-10 rounded-full object-cover">
        <span>${worker.name}</span>`;
      div.addEventListener("click", () => openProfile(worker.id));
      unassignedList.appendChild(div);
    }
  });
}


function openProfile(id) {
  const worker = workers.find(w => w.id === id);
  profileName.textContent = worker.name;
  profilePhoto.src = worker.photo;
  profileRole.textContent = worker.role;
  profileEmail.textContent = worker.email;
  profilePhone.textContent = worker.phone;
  profileExperiences.innerHTML = "";
  worker.experiences.forEach(e => {
    const p = document.createElement("p");
    p.textContent = `${e.role} at ${e.company} (${e.start} - ${e.end})`;
    profileExperiences.appendChild(p);
  });
  profilePopup.classList.remove("hidden");
}

closeProfile.addEventListener("click", () => profilePopup.classList.add("hidden"));


function renderRooms() {
  Object.values(rooms).forEach(room => {
    room.querySelectorAll(".workerCard").forEach(c => c.remove());
  });

  workers.forEach(worker => {
    if (worker.room) {
      const roomDiv = rooms[worker.room];
      const div = document.createElement("div");
      div.classList.add("workerCard", "flex", "items-center", "gap-2", "bg-green-200", "p-1", "rounded", "mt-1", "cursor-pointer");
      div.innerHTML = `<img src="${worker.photo}" class="w-8 h-8 rounded-full object-cover">
      <span>${worker.name}</span>
      <button class="bg-red-500 text-white px-1 rounded">X</button>`;

     
      div.querySelector("button").addEventListener("click", () => {
        worker.room = null;
        saveData();
        renderWorkers();
        renderRooms();
      });

      div.addEventListener("click", () => openProfile(worker.id));
      roomDiv.appendChild(div);
    }

   
    Object.entries(rooms).forEach(([key, room]) => {
      const empty = workers.filter(w => w.room === key).length === 0;
      if (empty && key !== "roomOne" && key !== "roomFive") {
        room.style.backgroundColor = "#ffcccc";
      } else {
        room.style.backgroundColor = "white";
      }
    });
  });
}


document.querySelectorAll(".addBtn").forEach(btn => {
  btn.addEventListener("click", (e) => {
    const roomDiv = e.target.closest("div");
    const roomId = roomDiv.id;
    const eligible = workers.filter(w => !w.room && checkRoleRoom(w.role, roomId));
    popupList.innerHTML = "";
    eligible.forEach(w => {
      const p = document.createElement("p");
      p.classList.add("cursor-pointer", "hover:bg-gray-200", "p-1");
      p.textContent = w.name;
      p.addEventListener("click", () => {
        w.room = roomId;
        saveData();
        renderWorkers();
        renderRooms();
        popupSelect.classList.add("hidden");
      });
      popupList.appendChild(p);
    });
    popupSelect.classList.remove("hidden");
  });
});

closePopup.addEventListener("click", () => popupSelect.classList.add("hidden"));

function checkRoleRoom(role, roomId) {
  if (roomId === "roomTwo" && role !== "receptionist") return false;
  if (roomId === "roomsx" && role !== "IT") return false;
  if (roomId === "roomTree" && role !== "security") return false;
  if (role === "cleaning" && roomId === "roomFor") return false;
  return true;
}

function clearForm() {
  fullName.value = ""; email.value = ""; phone.value = ""; photo.value = ""; role.value = "manager";
  experiences = []; renderExperienceList();
}


renderWorkers();
renderRooms();
